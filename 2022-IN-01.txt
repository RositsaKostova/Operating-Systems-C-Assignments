2022-IN-01
–í–∞—à–∏ –∫–æ–ª–µ–≥–∏ - –∞—Å–∏—Å—Ç–µ–Ω—Ç–∏ –ø–æ –û–° –∏–º–∞—Ç –Ω—É–∂–¥–∞ –æ—Ç –¥–µ–º–æ—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞ C, –∫–æ—è—Ç–æ
–¥–∞ —Å–ª—É–∂–∏ –∫–∞—Ç–æ –ø—Ä–∏–º–µ—Ä –∑–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ—Ü–µ—Å–∏. –ù–∞–ø–∏—à–µ—Ç–µ —Ç–∞–∫–∞–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞,
–ø—Ä–∏–µ–º–∞—â–∞ –¥–≤–∞ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—ä—Ä–∞ ‚Äì –µ–¥–Ω–æ—Ü–∏—Ñ—Ä–µ–Ω–∏ —á–∏—Å–ª–∞.

–ü—Ä–∏–º–µ—Ä–Ω–æ –∏–∑–≤–∏–∫–≤–∞–Ω–µ:
./main N D

–û–±—â –∞–ª–≥–æ—Ä–∏—Ç—ä–º –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞:
‚Ä¢ –Ω–∞—á–∞–ª–Ω–∏—è—Ç (—Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏) –ø—Ä–æ—Ü–µ—Å —Å—ä–∑–¥–∞–≤–∞ –ø—Ä–æ—Ü–µ—Å-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫
‚Ä¢ ùëÅ –Ω–∞ –±—Ä–æ–π –ø—ä—Ç–∏ —Å–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞:
	‚Äì —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è—Ç –ø—Ä–æ—Ü–µ—Å –∏–∑–≤–µ–∂–¥–∞ –Ω–∞ stdout –Ω–∏–∑–∞ ‚ÄúDING ‚Äù
	‚Äì –ø—Ä–æ—Ü–µ—Å—ä—Ç-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –∏–∑–≤–µ–∂–¥–∞ –Ω–∞ stdout –Ω–∏–∑–∞ ‚ÄúDONG‚Äù
	‚Äì —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è—Ç –ø—Ä–æ—Ü–µ—Å –∏–∑—á–∞–∫–≤–∞ ùê∑ —Å–µ–∫—É–Ω–¥–∏

–ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π—Ç–µ, —á–µ:
	‚Ä¢ –ø—Ä–æ—Ü–µ—Å—ä—Ç-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –≤–∏–Ω–∞–≥–∏ –∏–∑–≤–µ–∂–¥–∞ ‚ÄúDONG‚Äù —Å–ª–µ–¥ –∫–∞—Ç–æ —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è –ø—Ä–æ—Ü–µ—Å –µ –∏–∑–≤–µ–ª ‚ÄúDING ‚Äù
	‚Ä¢ —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è—Ç –ø—Ä–æ—Ü–µ—Å –≤–∏–Ω–∞–≥–∏ –∑–∞–ø–æ—á–≤–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ—Ç–æ —Å–ª–µ–¥ –∫–∞—Ç–æ –ø—Ä–æ—Ü–µ—Å–∞-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –µ –∏–∑–≤–µ–ª ‚ÄúDONG‚Äù
–ó–∞–±–µ–ª–µ–∂–∫–∞: –ó–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ—Ç–æ –ø–æ–≥–ª–µ–¥–Ω–µ—Ç–µ sleep(3).
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#include <err.h>
#include <unistd.h>
#include <sys/wait.h>
#include <stdlib.h>
#include <string.h>

const char* DING = "DING ";
const char* DONG = "DONG\n";

int str_to_int(const char* arg) {
    char* endptr;
    int num = strtol(arg, &endptr, 10);
    if (*arg == '\0' || *endptr != '\0') {
        errx(2, "Arguments must be integers from 1 to 9!\n");
    }
    if (num < 1 || num > 9) {
        errx(3, "Out of domain! Numbers must be between 1 and 9!\n");
    }
    return num;
}

void doParent(int N, int D, int toChild, int fromChild) {
    int signal = 1;
    for(int i = 0; i < N; i++) {
        if (write(1, DING, strlen(DING)) == -1) {err(13, "Parent failed to wtite DING!\n");}
        if (write(toChild, &signal, sizeof(signal)) == -1) {err(14, "Parent could not signal child!\n");}
        if (read(fromChild, &signal, sizeof(signal)) == -1) {err(15, "Parent could not hear from child!\n");}
        sleep(D);
    }
}

void doChild(int N, int fromParent, int toParent) {
    int signal;
    for(int i = 0; i < N; i++) {
        if (read(fromParent, &signal, sizeof(signal)) == -1) {err(10, "Child could not hear from parent!\n");}
        if (write(1, DONG, strlen(DONG)) == -1) {err(11, "Child failed to write DONG!\n");}
        if (write(toParent, &signal, sizeof(signal)) == -1) {err(12, "Child could not signal parent!\n");}
    }
}

int main(int argc, char* argv[]) {
    if (argc != 3) {
        errx(1, "Two numbers from 1 to 9 expected!\n");
    }

    int N = str_to_int(argv[1]);
    int D = str_to_int(argv[2]);

    int ParentToChild[2];
    int ChildToParent[2];

    if (pipe(ParentToChild) == -1) {
        err(4, "Could not create a pipe from parent process to child process!\n");
    }
    if (pipe(ChildToParent) == -1) {
        err(5, "Could not create a pipe from child process to parent process!\n");
    }

    pid_t pid = fork();
    if (pid == -1) {
        err(6, "Could not create a child process!\n");
    }

    if (pid == 0) {
        close(ParentToChild[1]);
        close(ChildToParent[0]);

        doChild(N, ParentToChild[0], ChildToParent[1]);

        close(ParentToChild[0]);
        close(ChildToParent[1]);
        exit(0);
    }

    close(ParentToChild[0]);
    close(ChildToParent[1]);

    doParent(N, D, ParentToChild[1], ChildToParent[0]);

    close(ParentToChild[1]);
    close(ChildToParent[0]);

    int status;
    if (wait(&status) == -1) {
        err(7, "Parent could not wait for the child!\n");
    }
    if (!WIFEXITED(status)) {
        errx(8, "Task failed: child was killed!\n");
    }
    if (WEXITSTATUS(status) != 0) {
        errx(9, "Task failed: exit status is not 0!\n");
    }
    return 0;
}
